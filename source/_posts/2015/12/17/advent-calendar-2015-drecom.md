title: 'ChatWork をちょっと便利にするブックマークレット'
description: 'これは【その1】ドリコム Advent Calendar 2015 の 17日目の記事です。ChatWorkをちょっと便利にするブックマークレットを紹介しています。'
date: 2015-12-17 00:00:00
tags: [Drecom, AdventCalendar, Bookmarklet]
---

## intro

これは [【その1】ドリコム Advent Calendar 2015](http://www.adventar.org/calendars/1043) の 17 日目の記事です。
16 日目は ozabi さんの [イラストメイキング](https://ozabeastrong.amebaownd.com/posts/374733) でした。

[【その2】ドリコム Advent Calendar 2015](http://www.adventar.org/calendars/1044) もあります。

去年、2014年は [アドベントカレンダーでニコニコカレンダーの話を書きたかった](http://qiita.com/ikkou/items/46bb4ddf637742bfcd70) という記事を書いていました。

今年、2015 年は、自分の観測範囲の中でも特に動きの激しかった JavaScript 界隈を振り返ろうかなーと思いましたが、~~素振りすら追いつけていない程度に疲弊しているので~~ 同じ JavaScript という括りでも疲弊することのない、ブックマークレットのことを書きます。

<!-- more -->

## whoami

- [@ikkou](https://twitter.com/ikkou) - [About](/about/)
- g1983ers
- Rails の Sprockets を捨てたいフロントエンド勢
  - 出来れば `browserify-rails` を始めとする `xxx-rails` 系すら避けたい
  - 最近だと f 社のフロントエンド革命論が好き
- ドリコムには 2015/09/01 に中途入社
  - ~~入社して最初に携わった漫画アプリは数ヶ月でクローズ判断(´・ω・｀)~~
  - Web フロントエンドを頑張るグループ所属
- 普段何をしているの?
  - いわゆる管理職的な何か
  - フロントエンドエンジニア的な何か
  - カメラマン的な何か

## toc

<!-- toc -->

## ドリコムは ChatWork を使用しています

去年のアドベントカレンダーにも書きましたが、弊社の標準コミュニケーションツールは ChatWork です。
通常の ChatWork ではなく、管理機能が強化されている [KDDI ChatWork](http://www.chatwork.com/kddi/) です。

ちょっと貧弱な検索に辟易しつつ、たまにやってくるサーバダウンにも負けず、流行りの Slack に流れることもなく使い続けているので、そろそろ「[導入事例](http://www.chatwork.com/ja/case/)」ページに掲載されても良いと思うのですが、いかがでしょうか？←

そして ChatWork はもう少し API が解放されると良いのになーと日々願っています。

## ブックマークレットとは何か

*ブックマークレット自体の説明が不要な方は、[ブックマークレットの紹介](#chatwork-をちょっと便利にするブックマークレット)まで飛ばしてください。*

ブックマークレット、あるいは Bookmarklet は、ブラウザ上で動作する小さなプログラムで、`JavaScript` で記述します。

{% blockquote ウィキペディア https://ja.wikipedia.org/wiki/ブックマークレット %} ブックマークレット (Bookmarklet) とは、ユーザーがウェブブラウザのブックマークなどから起動し、ウェブブラウザで簡単な処理を行う簡易的なプログラムのことである。携帯電話のウェブブラウザで足りない機能を補ったり、ウェブアプリケーションの処理を起動する為に使われることが多い。
{% endblockquote %}

お気に入り・ブックマークは、「登録したページを開く」だけですが、ブックマークレットは、「開く」だけではなく、これから例を挙げるように見ているページを対象にして、ちょっと便利なことが出来ます。

## ブックマークレットの使いかた

サンプルとして、シンプル、だけどちょっと意地悪なブックマークレットを用意しました。

```
javascript:(function(){document.body.innerHTML = "";}())
```

ブックマークレットは、ブラウザのアドレスバーに入れて使うものではありません。
ブラウザのアドレスバーに入れると、それをキーワードとして検索されるだけです。

ブックマークレットを簡単に試したい場合、Chrome のコンソールが便利です。

### Chrome のコンソールでブックマークレットを試す

ブックマークレットを試したいページで、コンソールを開きます。

- 右クリック→検証をクリック
- ブラウザのメニューにある表示→開発/管理→JavaScript コンソールを辿る
- ショートカットは Windows なら `Ctrl+Shift+J`、Mac なら `Opt+Cmd+J`

コンソールに `javascript:(function(){document.body.innerHTML = "";}())` という文字列をコピペします。

![](https://i.gyazo.com/1136c6c499bbaee61f57c4424aec830a.gif)

Enter を押すと画面が xxx になるので、ブラウザの更新ボタンを押して、続きを読んでください。~~あくまでジョークです。~~

### ブックマークバーに登録する

毎回コンソール画面を開くのも手間なので、恒常的に使うブックマークレットは、ブックマークバーに登録するのが一般的です。

まず、ブックマークバーを表示していない場合は、ブックマークバーを表示させます。

![](https://gyazo.com/da927cc8ef1d42d0e9b0387a30d4678a.gif)

その後、ブックマークバー上で、右クリック→ページを追加…と進みます。

表示された入力欄の「名前」にわかりやすい名前を、「URL」にブックマークレットを入力して「保存」をクリックします。

![](https://i.gyazo.com/50ce67b260a500769b9bf203f19a986e.png)

これでブックマークバーにブックマークレットが登録されます。

![](https://i.gyazo.com/7c3011964b3a0a22340995d25e029214.png)

あとはこのブックマークレットをクリックするだけで、このブックマークレットで言えば画面が真っ白になります。

---

## ChatWork をちょっと便利にするブックマークレット

ようやく本題です。

これから挙げるブックマークレットは、Chrome で動作を検証しています。

また、2015 年 12 月現在の ChatWork に対応していますが、ChatWork の DOM 構造が変わった場合には、使えなくなる可能性があります。
その場合は `textarea` の `#_chatText` を適切なものに変更すれば動きます。多分。

---

### ①「囲み枠タグ（見出しあり）」をちょっと便利にする

ChatWork にはいくつか独自のタグがあり、中でも「囲み枠タグ（見出しあり）」は、よく使います。
わざわざ自分で `[info][title]` …と打つのは少し面倒ですが、ブックマークレットを使えば簡単です。

#### ブックマークレット

```
javascript:(function(){c=$('#_chatText');f=c.val();r=new Array();r=f.split('\n');f='[info][title]'+r[0]+'[/title]';for(var i=1,n=r.length;i<n;i++){f=f+r[i]+'\n' ;}f=f+'[/info]';c.val(f);}())
```

#### before

```
タイトル
本文
本文
本文
```

#### after

```
[info][title]タイトル[/title]本文
本文
本文
[/info]
```

たまに、最後の `[/info]` が `[info]` になっていて、意図しない表示になっているケースが見受けられるので、そういう人こそこのブックマークレットを使うと捗ると思います。

---

### ②見ているページのタイトルと URL の共有をちょっと便利にする

これは①の転用例です。

みんなに共有したいな！というページを見つけた時、どうしていますか？

ただ URL を貼り付けるだけだと味気が無いですし、何よりそれが何のページか分かりません。

そうするとページのタイトルも一緒に共有したくなりますが、その場合はアドレスバーの URL をコピーして ChatWork のテキストエリアに貼り付け、次にページのタイトルをコピーしてまた貼り付け、と少々面倒になります。

このブックマークレットは、見ているページのページタイトルと URL を、「囲み枠タグ（見出しあり）」を適用した状態にします。

#### ブックマークレット

```
javascript: (function(){prompt('Press Ctrl+C, then press Enter Key','[info][title]'+document.title+'[/title]'+location.href+'[/info]')})();
```

例えば、 [【その1】ドリコム Advent Calendar 2015](http://www.adventar.org/calendars/1043) のページでこのブックマークレットを使うと、このように「囲み枠タグ（見出しあり）」が適用されたテキストが選択された状態になります。

![](https://i.gyazo.com/19ce7d3aec72894d2c6444961a3ee8e6.png)

あとはこのテキストをおもむろにコピーして、ChatWork のテキストエリアに貼り付けるだけです。

```
[info][title]【その1】ドリコム Advent Calendar 2015 - Adventar[/title]http://www.adventar.org/calendars/1043[/info]
```

実際に投稿すると、「囲み枠タグ（見出しあり）」が適用されています。

![](https://i.gyazo.com/f91aff1db7d8010a3fae836b97d7706e.png)

`[/info]` の後に、私感なりを加えて投稿すると捗るのではないでしょうか。

---

### ③「すべて選択」をちょっと便利にする

数人程度であれば問題ないですが、参加している人数が多いグループチャットで「すべて選択」を使うと、それだけで画面を埋め尽くしてしまいます。

このブックマークレットを使うと、アイコンが横に並ぶだけにする、あるいは名前の後ろに存在している改行を消すことが出来ます。

グループチャット内のメンバー全員に `TO` 付きのメッセージを送りたい時、例えばグループチャット内で打ち上げ等のスケジュール調整を行なう時などが当てはまります。

#### 改行なし・アイコンのみにするブックマークレット

```
javascript:(function(){var f=$('#_chatText');f.val(f.val().replace(/].+\n/g,']'));}())
```

#### before

```
[To:000001] 佐藤さん
[To:000002] 山田さん
[To:000003] 田中さん
[To:000004] 鈴木さん
```

#### after

```
[To:000001][To:000002][To:000003][To:000004]
```

#### 改行なし・アイコン + 名前にするブックマークレット

```
javascript:(function(){var f=$('#_chatText');f.val(f.val().replace(/[\n\r]/g," "));}())
```

#### before

```
[To:000001] 佐藤さん
[To:000002] 山田さん
[To:000003] 田中さん
[To:000004] 鈴木さん
```

#### after

```
[To:000001] 佐藤さん [To:000002] 山田さん [To:000003] 田中さん [To:000004] 鈴木さん
```

ちなみにこれは、「ChatWork ご意見・ご要望フォーラム」に挙がっている「[TO付→すべて選択で「改行なし」や「改行・名前なし」を選択したい](http://feedback-ja.chatwork.com/forums/269086-chatwork-%E3%81%94%E6%84%8F%E8%A6%8B-%E3%81%94%E8%A6%81%E6%9C%9B%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A9%E3%83%A0/suggestions/7010277-to%E4%BB%98-%E3%81%99%E3%81%B9%E3%81%A6%E9%81%B8%E6%8A%9E%E3%81%A7-%E6%94%B9%E8%A1%8C%E3%81%AA%E3%81%97-%E3%82%84-%E6%94%B9%E8%A1%8C-%E5%90%8D%E5%89%8D%E3%81%AA%E3%81%97-%E3%82%92%E9%81%B8%E6%8A%9E%E3%81%97%E3%81%9F%E3%81%84)」を解決出来るブックマークレットです。
他のブックマークレットに比べ、これはちょっとどころか結構便利にするのでは？と勝手に思っています。

## まとめ

ChatWork をちょっと便利にするブックマークレットを3つ紹介しました。

ChatWork をより便利にするには、ブックマークレットではなく拡張機能の方が適しているかもしれませんが、リロードすれば元に戻ってしまう、そんなブックマークレットの儚い感じが好きです。

現場からは以上です。

---

[【その1】ドリコム Advent Calendar 2015](http://www.adventar.org/calendars/1043) の 18 日目は Y さんです。
[【その2】ドリコム Advent Calendar 2015](http://www.adventar.org/calendars/1044) の 18 日目は m-szk さんです。

---

## 参考

- [意外と知らないChrome Developer Toolsの便利な機能 - Qiita](http://qiita.com/grapswiz/items/1e48815f8b6c921c2f1c)
- [Ruby - 新人エンジニアが業務効率化のためにブックマークレット作ってみたよ - Qiita](http://qiita.com/yoppe/items/f074508cec65f3ae91f1)
- [bookmarklet - ブックマークレットを作るときのTips - Qiita](http://qiita.com/xtetsuji/items/e8b61bb39c41b7a9345e)
